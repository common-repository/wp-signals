!function(e){"use strict";function t(){return window.location.href.indexOf("#")>=0?window.location.href.substring(0,window.location.href.indexOf("#")):window.location.href}function n(t,n,a,i={}){e(".wp-signals-alert").remove();let s="";if(i.fields&&i.fields.forEach(e=>{s+=`<div class="form-group"${e.title?"":' style="margin-top: -55px !important;"'}>`,"input"===e.type&&(e.title&&(s+=`<label for="${e.name}">${e.title}</label>`),s+=`<input type="text"${e.autocomplete?' autocomplete="'+e.autocomplete+'"':""} name="${e.name}" value="" />`),"select"===e.type&&(s+=`<label for="${e.name}">${e.title}</label>`,s+=`<select name="${e.name}">`,e.options.forEach(e=>{s+=`<option value="${e.value.replace(new RegExp(" ","g"),"-")}">${e.text||e.value}</option>`}),s+="</select>"),s+="</div>"}),t.indexOf("upgrade")>=0&&n.indexOf("Please upgrade")>=0&&window.location.href.indexOf("/wp-admin/")>=0){i.confirm="Upgrade now";let t=window.location.href.substring(0,window.location.href.indexOf("/wp-admin/"));e('[data-trial="false"]').length>0?t+="/wp-admin/admin.php?billing_cycle=annual&page=wp-signals-pricing":t+="/wp-admin/admin.php?billing_cycle=annual&trial=true&page=wp-signals-pricing",i.onConfirm=function(){window.location.href=t}}e(".wp-signals-screen").append(`<div class="wp-signals-alert wp-signals-alert-${a}">\n\t\t\t<div class="alert-contents">\n\t\t\t<span class="close">&times;</span>\n\t\t\t<h3>${t}</h3>\t\t\t\n\t\t\t<p>${n}</p>\n\t\t\t\n\t\t\t${s}\n\t\t\n\t\t\t${i.onConfirm?'<button class="close">'+(i.cancel||"Cancel")+'</button><button class="confirm">'+(i.confirm||"Confirm")+"</button>":'<button class="close">Got it.</button>'}\n\t\t\t</div>\n\t\t\t</div>\n\t\t`),e(".wp-signals-alert").css("display","block"),e(".wp-signals-alert .confirm").unbind("click").click((function(t){t.preventDefault();let n=!1,a={};e(".wp-signals-alert input").css("box-shadow","none"),i.fields&&(e(".wp-signals-alert").find("input").filter((function(){return!this.value})).length>0&&(n=!0,e(".wp-signals-alert").find("input").filter((function(){return!this.value})).css("box-shadow","2px 2px 2px red")),e(".wp-signals-alert").find("input, select").each((function(){a[e(this).attr("name")]=e(this).val()}))),n||(i.onConfirm&&i.onConfirm(a),e(".wp-signals-alert").remove())})),e(".wp-signals-alert .close").unbind("click").click((function(t){t.preventDefault(),e(".wp-signals-alert").remove()}))}e(document).ready(()=>{function a(){e(".wp-signals-events-screen table.events").each((function(){e(this).find("tr").length>1?e(this).find("tr.no-events").addClass("hidden"):e(this).find("tr.no-events").removeClass("hidden"),e(this).find("img.remove-event").unbind("click").css("cursor","pointer").click((function(i){i.preventDefault();let s={event:e(this).closest("tr").find("td").eq(0).text(),path:e(this).closest("tr").find("td").eq(1).text()};n("Confirmation needed","Are you sure you want to delete this custom event trigger?","error",{onConfirm:()=>{e.post(t(),{action:"remove",event:s.event,path:s.path}),e(this).closest("tr").remove(),a()}})}))}))}function i(e){const t=[];return e.forEach(e=>{const n=e.split("-").map(e=>1===e.length?"0"+e:e).join("-");t.push(n)}),t.sort()}function s(t,n=!1){let a=void 0;a="string"==typeof t||t instanceof String?JSON.parse(t.replace(new RegExp("'","g"),'"')):t;const i=[];if(Object.keys(a).forEach(e=>{const t=e.split("-").map(e=>1===e.length?"0"+e:e).join("-");i.push([t,a[e]])}),n&&e(".wp-signals-analytics-screen #chart").data("information")){const t=s(e(".wp-signals-analytics-screen #chart").data("information"));for(let e of t){const t=e[0];i.find(e=>e[0]===t)||i.push([t,0])}}return i.sort((e,t)=>e<t?-1:e>t?1:0),i}e(".wp-signals-settings-screen").length>0&&e('input[name="redirector"]').length>0&&(window.location.href=e('input[name="redirector"]').val()),e('.wp-signals-settings-screen form.pixel-form select[name="ad-account"]').on("change",(function(){e('.wp-signals-settings-screen form.pixel-form select[name="pixel-id"] option[data-account-id]').hide(),e('.wp-signals-settings-screen form.pixel-form select[name="pixel-id"] option[data-account-id="'+e(this).val()+'"]').show(),e('.wp-signals-settings-screen form.pixel-form select[name="pixel-id"]').val("choose")})).trigger("change"),e(".wp-signals-settings-screen a.create-pixel-btn").click((function(a){if(a.preventDefault(),"choose"===e('.wp-signals-settings-screen form.pixel-form select[name="ad-account"] option:selected').val())return void n("Ad account","Please select an ad account (from the first dropdown) and try again.","error");const i=e('.wp-signals-settings-screen form.pixel-form select[name="ad-account"]').val(),s=e('.wp-signals-settings-screen form.pixel-form select[name="ad-account"] option:selected').data("disabled");!i||s&&s+""=="true"?n("Ad account","You cannot add a pixel on a business account. Please select a different ad account and try again.","error"):n("Add pixel","To create a new pixel, please enter it's name in the input box below... The pixel will be created in your selected ad account.","error",{fields:[{type:"input",title:"Pixel name",autocomplete:"off",name:"identifier"}],confirm:"Add pixel",onConfirm:a=>{a&&a.identifier&&e.post(t(),{action:"pixel",name:a.identifier,account:i}).then(t=>{if(t&&"string"==typeof t&&t.indexOf("{")>=0&&(t=JSON.parse(t)),t.id&&!t.error){const n=t.id;e('.wp-signals-settings-screen form.pixel-form select[name="pixel-id"]').append(`<option data-account-id="${i}" value="${n}">${a.identifier} (#${n})</option>`),e('.wp-signals-settings-screen form.pixel-form select[name="pixel-id"]').val(n)}t.error&&n("Failed","Failed to create pixel. You might already have a pixel for this ad account, or you are missing the necessary permissions. Response: "+t.error,"error")})}})})),e(".wp-signals-dashboard-screen div.dashboard-status div.image img[data-status]").css("cursor","pointer").click((function(n){n.preventDefault();let a="off";"off"===e(this).data("status")&&(a="on"),e.post(t(),{status:a}).then(()=>{window.location.href=t()+"#updated",window.location.reload()})})),e(".wp-signals-settings-screen .manual-pixel-setup-btn").css("cursor","pointer").click(e=>{e.preventDefault(),n("Confirmation needed","Using the manual pixel setup only requires your pixel ID, but it will make it harder to setup the Conversions API and load Facebook analytics (you might need to generate a Facebook access token manually).<br /><br /> We strongly recommend using the Wizard to connect your Facebook account to our plugin, unless you cannot find/load your pixel with the wizard.","error",{confirm:"Use the manual setup anyway",onConfirm:()=>{const e=new URLSearchParams(location.search||"");e.set("result","success"),e.set("setup","manual"),window.location.href=window.location.pathname+"?"+e.toString()}})}),e(".wp-signals-settings-screen .manual-pixel-link").css("cursor","pointer").click(e=>{e.preventDefault();const t=new URLSearchParams(location.search||"");t.set("result","success"),t.set("setup","manual"),window.location.href=window.location.pathname+"?"+t.toString()}),e(".wp-signals-settings-screen .btn-setup-pixel").click(t=>{if(e('form.pixel-form input[name="pixel-limited"]').val("false"),e('form.pixel-form input[name="simple-pixel-id"]').length>0&&0===e('form.pixel-form input[name="simple-pixel-id"]').val().length&&(t.preventDefault(),t.stopPropagation(),n("Incomplete data","You must enter a valid pixel id to complete the setup procedure. Please try again.","error")),0===e('form.pixel-form input[name="simple-pixel-id"]').length&&(e('form.pixel-form select[name="pixel-id"]').val()&&"choose"!==e('form.pixel-form select[name="pixel-id"]').val()?(e('form.pixel-form input[name="pixel-name"]').val(e('form.pixel-form select[name="pixel-id"] option:selected').text()),"true"==e('form.pixel-form select[name="pixel-id"] option:selected').data("disabled")&&e('form.pixel-form input[name="pixel-limited"]').val("true")):(t.preventDefault(),t.stopPropagation(),n("Incomplete data","You must select a pixel to complete the setup procedure. Please try again.","error"))),e('form.pixel-form input[name="pixel-name"]').val()||e('form.pixel-form input[name="pixel-name"]').val("FB Pixel"),e('form.pixel-form input[name="simple-pixel-id"]').length>0&&e('form.pixel-form input[name="simple-pixel-id"]').val()){const t="("+e('form.pixel-form input[name="simple-pixel-id"]').val()+")";e('form.pixel-form input[name="pixel-name"]').val(e('form.pixel-form input[name="pixel-name"]').val()+" "+t)}}),e(".wp-signals-component-pro button.btn-upgrade-to-pro").css("cursor","pointer").click(e=>{e.preventDefault(),window.location.href="/wp-admin/admin.php?billing_cycle=annual&trial=true&page=wp-signals-pricing"}),e(".wp-signals-settings-screen button.btn-delete-data").css("cursor","pointer").click(a=>{a.preventDefault(),n("Confirmation needed","Are you sure you want to reset your plugin by starting from scratch and clearing all settings?","error",{onConfirm:()=>{e.post(t(),{delete:"data"}).then(()=>{window.location.href=t()+"#updated",window.location.reload()})}})}),e(".wp-signals-settings-screen div.form-check, .wp-signals-events-screen div.form-check").css("cursor","pointer").click((function(a){a.preventDefault(),"false"==e(this).attr("data-value")&&"false"==e(this).attr("data-available")&&e(this).attr("data-error-title")&&e(this).attr("data-error-message")?n(e(this).attr("data-error-title"),e(this).attr("data-error-message"),"error"):(e(this).attr("data-value","true"==e(this).attr("data-value")?"false":"true"),e.post(t(),{[e(this).attr("data-id")]:"true"==e(this).attr("data-value")?"true":"false"}),"sse"===e(this).attr("data-id")&&("true"==e(this).attr("data-value")?e("div.manual-sse-div-info").show():e("div.manual-sse-div-info").hide()))})),e('.wp-signals-settings-screen textarea[data-id="sse-manual-token"]').bind("input propertychange",(function(){const n=e(this).val().trim().replace(/ /g,"");0===n.length||n&&n.length>=50?(e(this).css("box-shadow","3px 2px 5px rgba(100, 255, 100, 0.6)"),0===n.length&&e(this).css("box-shadow","none"),e.post(t(),{[e(this).attr("data-id")]:e(this).val().trim()})):e(this).css("box-shadow","3px 2px 5px rgba(255, 100, 100, 0.6)")})),a(),e(".wp-signals-events-screen button.btn-add-event").css("cursor","pointer").click(i=>{i.preventDefault(),n("Add event","To create an event trigger, select the event type you want to send, and the 'path' for which you want to trigger the event. For example, using /contact/ will trigger the event for all page urls containing the pattern /contact/.","error",{fields:[{type:"select",name:"event",title:"Facebook event:",options:[{value:"AddToCart"},{value:"AddToWishlist"},{value:"CompleteRegistration"},{value:"Contact"},{value:"Donate"},{value:"InitiateCheckout"},{value:"Lead"},{value:"Purchase"},{value:"Search"},{value:"StartTrial"},{value:"SubmitApplication"},{value:"Subscribe"},{value:"ViewContent"}]},{type:"select",name:"matching",title:"Page url:",options:[{value:"starts with"},{value:"contains"},{value:"matches"},{value:"ends with"}]},{type:"input",autocomplete:"off",name:"path"}],confirm:"Add event",onConfirm:n=>{if(n&&n.event&&n.matching&&n.path){n.path=("starts-with"===n.matching||"contains"===n.matching?"*":"")+n.path+("ends-with"===n.matching||"contains"===n.matching?"*":""),e.post(t(),{action:"add",event:n.event,path:n.path});const i=e("table.events").data("icons");e("table.events").append(`<tr>\n\t\t\t\t\t\t\t<td>${n.event}</td>\n\t\t\t\t\t\t\t<td>${n.path}</td>\n\t\t\t\t\t\t\t<td style="width: 100px; text-align: center;"><img class="remove-event" src="${i}/delete.png" /></td>\n\t\t\t\t\t\t</tr>`),a()}}})}),e(".wp-signals-screen .button-option[data-href]").css("cursor","pointer").click((function(){window.location.href=e(this).data("href")})),e(".wp-signals-analytics-screen #chart").each(()=>{var n={xAxis:{type:"category",boundaryGap:!1},yAxis:{type:"value",boundaryGap:[0,"30%"]},tooltip:{show:!0,trigger:"axis"},visualMap:{type:"piecewise",show:!1,dimension:0,seriesIndex:0,pieces:[{gt:1,lt:3,color:"rgba(0, 180, 0, 0.5)"},{gt:5,lt:7,color:"rgba(0, 180, 0, 0.5)"}]},series:[{name:"Auto tracking",type:"line",smooth:.6,symbol:"circle",color:"green",lineStyle:{color:"green",width:5},markLine:{symbol:["none","none"],label:{show:!1},data:[{xAxis:1},{xAxis:3},{xAxis:5},{xAxis:7}]},areaStyle:{color:"rgba(0, 180, 0, 0.5)"},data:s(e(".wp-signals-analytics-screen #chart").data("information"))}]};e(".wp-signals-analytics-screen #chart").data("pixel-limited")?echarts.init(e(".wp-signals-analytics-screen #chart")[0]).setOption(n):e.get(t()+"&data=json&operation=fb-analytics").then(e=>{e&&Object.keys(e).length>0&&!e.error&&n.series.push({name:"Facebook tracking",type:"line",smooth:.6,symbol:"rect",color:"blue",lineStyle:{color:"blue",width:5},markLine:{symbol:["none","none"],label:{show:!1},data:[{xAxis:1},{xAxis:3},{xAxis:5},{xAxis:7}]},areaStyle:{color:"rgba(0, 0, 180, 0.1)"},data:s(e,!0)})}).always(()=>{echarts.init(e(".wp-signals-analytics-screen #chart")[0]).setOption(n)})}),e(".wp-signals-analytics-screen #keyschart").each(()=>{var n=void 0;e.get(t()+"&data=json&operation=fb-match-keys").then(e=>{("string"==typeof e||e instanceof String)&&(e=JSON.parse(e.replace(new RegExp("'","g"),'"'))),e.error&&delete e.error,n=0===Object.keys(e).length?void 0:{xAxis:{type:"category",boundaryGap:!1,data:i(Object.keys(e[Object.keys(e)[0]]))},yAxis:{type:"value"},tooltip:{trigger:"axis"},legend:{data:Object.keys(e)},series:Object.keys(e).map((t,n)=>({name:t,data:s(e[t]).map(([e,t])=>t),itemStyle:{color:["#c25652","#51616d","#77a8ae","#429da3"][n%4]},smooth:!1,type:"line"}))}}).always(()=>{n?(e(".wp-signals-analytics-screen .keyschart-detail").css("display","block"),echarts.init(e(".wp-signals-analytics-screen #keyschart")[0]).setOption(n)):(e(".wp-signals-analytics-screen #keyschart").html('<p class="no-info-chart">No information. Please make sure your pixel is setup correctly, and wait for Facebook to process your data (might take up to 30 minutes).</p>'),e(".wp-signals-analytics-screen .keyschart-detail").remove())})})})}(jQuery);
